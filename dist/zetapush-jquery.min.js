!function(e,t){"object"==typeof module&&module.exports&&"function"==typeof require?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define(t):e.log=t()}(this,function(){function e(e){return typeof console===c?!1:void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):a}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t){return function(){typeof console!==c&&(r(t),s[e].apply(s,arguments))}}function r(e){for(var t=0;t<u.length;t++){var n=u[t];s[n]=e>t?a:s.methodFactory(n,e)}}function o(e){var t=(u[e]||"silent").toUpperCase();try{return void(window.localStorage.loglevel=t)}catch(n){}try{window.document.cookie="loglevel="+t+";"}catch(n){}}function i(){var e;try{e=window.localStorage.loglevel}catch(t){}if(typeof e===c)try{e=/loglevel=([^;]+)/.exec(window.document.cookie)[1]}catch(t){}void 0===s.levels[e]&&(e="WARN"),s.setLevel(s.levels[e])}var s={},a=function(){},c="undefined",u=["trace","debug","info","warn","error"];s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=function(t,r){return e(t)||n(t,r)},s.setLevel=function(e){if("string"==typeof e&&void 0!==s.levels[e.toUpperCase()]&&(e=s.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;return o(e),r(e),typeof console===c&&e<s.levels.SILENT?"No console available for logging":void 0},s.enableAll=function(){s.setLevel(s.levels.TRACE)},s.disableAll=function(){s.setLevel(s.levels.SILENT)};var l=typeof window!==c?window.log:void 0;return s.noConflict=function(){return typeof window!==c&&window.log===s&&(window.log=l),s},i(),s}),this.org=this.org||{},org.cometd={},org.cometd.CometD=function(e){function t(e,t){try{return e[t]}catch(n){return void 0}}function n(e){return org.cometd.Utils.isString(e)}function r(e){return void 0===e||null===e?!1:"function"==typeof e}function o(e,t){if(window.console){var n=window.console[e];r(n)&&n.apply(window.console,t)}}function i(e){it._debug("Configuring cometd object with",e),n(e)&&(e={url:e}),e||(e={}),xt=it._mixin(!1,xt,e);var t=it.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var r=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(t),o=r[2],i=r[8],s=r[9];if(at=it._isCrossDomain(o),xt.appendMessageTypeToURL)if(void 0!==s&&s.length>0)it._info("Appending message type to URI "+i+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),xt.appendMessageTypeToURL=!1;else{var a=i.split("/"),c=a.length-1;i.match(/\/$/)&&(c-=1),a[c].indexOf(".")>=0&&(it._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),xt.appendMessageTypeToURL=!1)}}function s(e){if(e){var t=pt[e.channel];t&&t[e.id]&&(delete t[e.id],it._debug("Removed",e.listener?"listener":"subscription",e))}}function a(e){e&&!e.listener&&s(e)}function c(){for(var e in pt){var t=pt[e];if(t)for(var n=0;n<t.length;++n)a(t[n])}}function u(e){ut!==e&&(it._debug("Status",ut,"->",e),ut=e)}function l(){return"disconnecting"===ut||"disconnected"===ut}function g(){return++lt}function f(e,t,n,o,i){try{return t.call(e,o)}catch(s){it._debug("Exception during execution of extension",n,s);var a=it.onExtensionException;if(r(a)){it._debug("Invoking extension exception callback",n,s);try{a.call(it,s,n,i,o)}catch(c){it._info("Exception during execution of exception callback in extension",n,c)}}return o}}function d(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=xt.reverseIncomingExtensions?bt.length-1-t:t,o=bt[n],i=o.extension.incoming;if(r(i)){var s=f(o.extension,i,o.name,e,!1);e=void 0===s?e:s}}return e}function h(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=bt[t],o=n.extension.outgoing;if(r(o)){var i=f(n.extension,o,n.name,e,!0);e=void 0===i?e:i}}return e}function p(e,t){var n=pt[e];if(n&&n.length>0)for(var o=0;o<n.length;++o){var i=n[o];if(i)try{i.callback.call(i.scope,t)}catch(s){it._debug("Exception during notification",i,t,s);var a=it.onListenerException;if(r(a)){it._debug("Invoking listener exception callback",i,s);try{a.call(it,s,i,i.listener,t)}catch(c){it._info("Exception during execution of listener callback",i,c)}}}}}function m(e,t){p(e,t);for(var n=e.split("/"),r=n.length-1,o=r;o>0;--o){var i=n.slice(0,o).join("/")+"/*";o===r&&p(i,t),i+="*",p(i,t)}}function v(){null!==vt&&org.cometd.Utils.clearTimeout(vt),vt=null}function b(e){v();var t=yt.interval+mt;it._debug("Function scheduled in",t,"ms, interval =",yt.interval,"backoff =",mt,e),vt=org.cometd.Utils.setTimeout(it,e,t)}function y(e,t,n,o){for(var i=0;i<t.length;++i){var s=t[i],a=""+g();s.id=a,gt&&(s.clientId=gt);var c=void 0;r(s._callback)&&(c=s._callback,delete s._callback),s=h(s),void 0!==s&&null!==s?(s.id=a,t[i]=s,c&&(Tt[a]=c)):t.splice(i--,1)}if(0!==t.length){var u=it.getURL();xt.appendMessageTypeToURL&&(u.match(/\/$/)||(u+="/"),o&&(u+=o));var l={url:u,sync:e,messages:t,onSuccess:function(e){try{_t.call(it,e)}catch(t){it._debug("Exception during handling of messages",t)}},onFailure:function(e,t,n){try{var r=it.getTransport();n.connectionType=r?r.getType():"unknown",St.call(it,e,t,n)}catch(o){it._debug("Exception during handling of failure",o)}}};it._debug("Send",l),nt.send(l,n)}}function T(e){ft>0||ht===!0?dt.push(e):y(!1,[e],!1)}function w(){mt=0}function k(){mt<xt.maxBackoff&&(mt+=xt.backoffIncrement)}function x(){++ft}function _(){var e=dt;dt=[],e.length>0&&y(!1,e,!1)}function S(){if(--ft,0>ft)throw"Calls to startBatch() and endBatch() are not paired";0!==ft||l()||ht||_()}function C(){if(!l()){var e={channel:"/meta/connect",connectionType:nt.getType()};kt||(e.advice={timeout:0}),u("connecting"),it._debug("Connect sent",e),y(!1,[e],!0,"connect"),u("connected")}}function L(){u("connecting"),b(function(){C()})}function R(e){e&&(yt=it._mixin(!1,{},xt.advice,e),it._debug("New advice",yt))}function U(e){if(v(),e&&nt&&nt.abort(),gt=null,u("disconnected"),ft=0,w(),nt=null,dt.length>0){var t=dt;dt=[],St.call(it,void 0,t,{reason:"Disconnected"})}}function I(e,t,n){var o=it.onTransportFailure;if(r(o)){it._debug("Invoking transport failure callback",e,t,n);try{o.call(it,e,t,n)}catch(i){it._info("Exception during execution of transport failure callback",i)}}}function E(e,t){r(e)&&(t=e,e=void 0),gt=null,c(),l()?(ct.reset(),R(xt.advice)):R(it._mixin(!1,yt,{reconnect:"retry"})),ft=0,ht=!0,rt=e,ot=t;var n="1.0",o=it.getURL(),i=ct.findTransportTypes(n,at,o),s={version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:i,_callback:t,advice:{timeout:yt.timeout,interval:yt.interval}},a=it._mixin(!1,{},rt,s);if(!nt&&(nt=ct.negotiateTransport(i,n,at,o),!nt)){var g="Could not find initial transport among: "+ct.getTransportTypes();throw it._warn(g),g}it._debug("Initial transport is",nt.getType()),u("handshaking"),it._debug("Handshake sent",a),y(!1,[a],!1,"handshake")}function N(){u("handshaking"),ht=!0,b(function(){E(rt,ot)})}function q(e){var t=Tt[e.id];r(t)&&(delete Tt[e.id],t.call(it,e))}function A(e){q(e),m("/meta/handshake",e),m("/meta/unsuccessful",e);var t=!l()&&"none"!==yt.reconnect;t?(k(),N()):U(!1)}function F(e){if(e.successful){gt=e.clientId;var t=it.getURL(),n=ct.negotiateTransport(e.supportedConnectionTypes,e.version,at,t);if(null===n){var r="Could not negotiate transport with server; client=["+ct.findTransportTypes(e.version,at,t)+"], server=["+e.supportedConnectionTypes+"]",o=it.getTransport();return I(o.getType(),null,{reason:r,connectionType:o.getType(),transport:o}),it._warn(r),void U(!0)}nt!==n&&(it._debug("Transport",nt.getType(),"->",n.getType()),nt=n),ht=!1,_(),e.reestablish=wt,wt=!0,q(e),m("/meta/handshake",e);var i=l()?"none":yt.reconnect;switch(i){case"retry":w(),L();break;case"none":U(!1);break;default:throw"Unrecognized advice action "+i}}else A(e)}function O(e){var t="1.0",n=it.getURL(),r=it.getTransport(),o=ct.findTransportTypes(t,at,n),i=ct.negotiateTransport(o,t,at,n);i?(it._debug("Transport",r.getType(),"->",i.getType()),I(r.getType(),i.getType(),e.failure),A(e),nt=i):(I(r.getType(),null,e.failure),it._warn("Could not negotiate transport; client=["+o+"]"),U(!0),A(e))}function j(e){m("/meta/connect",e),m("/meta/unsuccessful",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":L(),k();break;case"handshake":ct.reset(),w(),N();break;case"none":U(!1);break;default:throw"Unrecognized advice action"+t}}function J(e){if(kt=e.successful){m("/meta/connect",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":w(),L();break;case"none":U(!1);break;default:throw"Unrecognized advice action "+t}}else j(e)}function M(e){kt=!1,j(e)}function B(e){U(!0),q(e),m("/meta/disconnect",e),m("/meta/unsuccessful",e)}function D(e){e.successful?(U(!1),q(e),m("/meta/disconnect",e)):B(e)}function W(e){B(e)}function P(e){var t=pt[e.subscription];if(t)for(var n=t.length-1;n>=0;--n){var r=t[n];if(r&&!r.listener){delete t[n],it._debug("Removed failed subscription",r);break}}q(e),m("/meta/subscribe",e),m("/meta/unsuccessful",e)}function H(e){e.successful?(q(e),m("/meta/subscribe",e)):P(e)}function z(e){P(e)}function X(e){q(e),m("/meta/unsubscribe",e),m("/meta/unsuccessful",e)}function Z(e){e.successful?(q(e),m("/meta/unsubscribe",e)):X(e)}function $(e){X(e)}function G(e){q(e),m("/meta/publish",e),m("/meta/unsuccessful",e)}function Q(e){void 0===e.successful?void 0!==e.data?m(e.channel,e):it._warn("Unknown Bayeux Message",e):e.successful?(q(e),m("/meta/publish",e)):G(e)}function V(e){G(e)}function K(e){if(e=d(e),void 0!==e&&null!==e){R(e.advice);var t=e.channel;switch(t){case"/meta/handshake":F(e);break;case"/meta/connect":J(e);break;case"/meta/disconnect":D(e);break;case"/meta/subscribe":H(e);break;case"/meta/unsubscribe":Z(e);break;default:Q(e)}}}function Y(e){var t=pt[e];if(t)for(var n=0;n<t.length;++n)if(t[n])return!0;return!1}function et(e,t){var o={scope:e,method:t};if(r(e))o.scope=void 0,o.method=e;else if(n(t)){if(!e)throw"Invalid scope "+e;if(o.method=e[t],!r(o.method))throw"Invalid callback "+t+" for scope "+e}else if(!r(t))throw"Invalid callback "+t;return o}function tt(e,t,n,r){var o=et(t,n);it._debug("Adding",r?"listener":"subscription","on",e,"with scope",o.scope,"and callback",o.method);var i={channel:e,scope:o.scope,callback:o.method,listener:r},s=pt[e];return s||(s=[],pt[e]=s),i.id=s.push(i)-1,it._debug("Added",r?"listener":"subscription",i),i[0]=e,i[1]=i.id,i}var nt,rt,ot,it=this,st=e||"default",at=!1,ct=new org.cometd.TransportRegistry,ut="disconnected",lt=0,gt=null,ft=0,dt=[],ht=!1,pt={},mt=0,vt=null,bt=[],yt={},Tt={},wt=!1,kt=!1,xt={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(e,n){for(var r=n||{},o=2;o<arguments.length;++o){var i=arguments[o];if(void 0!==i&&null!==i)for(var s in i){var a=t(i,s),c=t(r,s);if(a!==n&&void 0!==a)if(e&&"object"==typeof a&&null!==a)if(a instanceof Array)r[s]=this._mixin(e,c instanceof Array?c:[],a);else{var u="object"!=typeof c||c instanceof Array?{}:c;r[s]=this._mixin(e,u,a)}else r[s]=a}}return r},this._warn=function(){o("warn",arguments)},this._info=function(){"warn"!==xt.logLevel&&o("info",arguments)},this._debug=function(){"debug"===xt.logLevel&&o("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host};var _t,St;this.send=T,this.receive=K,_t=function(e){it._debug("Received",e);for(var t=0;t<e.length;++t){var n=e[t];K(n)}},St=function(e,t,n){it._debug("handleFailure",e,t,n),n.transport=e;for(var r=0;r<t.length;++r){var o=t[r],i={id:o.id,successful:!1,channel:o.channel,failure:n};switch(n.message=o,o.channel){case"/meta/handshake":O(i);break;case"/meta/connect":M(i);break;case"/meta/disconnect":W(i);break;case"/meta/subscribe":i.subscription=o.subscription,z(i);break;case"/meta/unsubscribe":i.subscription=o.subscription,$(i);break;default:V(i)}}},this.registerTransport=function(e,t,n){var o=ct.add(e,t,n);return o&&(this._debug("Registered transport",e),r(t.registered)&&t.registered(e,this)),o},this.notifyListeners=m,this.getTransportTypes=function(){return ct.getTransportTypes()},this.unregisterTransport=function(e){var t=ct.remove(e);return null!==t&&(this._debug("Unregistered transport",e),r(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){ct.clear()},this.findTransport=function(e){return ct.find(e)},this.configure=function(e){i.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){u("disconnected"),wt=!1,E(e,t)},this.disconnect=function(e,t,n){if(!l()){"boolean"!=typeof e&&(n=t,t=e,e=!1),r(t)&&(n=t,t=void 0);var o={channel:"/meta/disconnect",_callback:n},i=this._mixin(!1,{},t,o);u("disconnecting"),y(e===!0,[i],!1,"disconnect")}},this.startBatch=function(){x()},this.endBatch=function(){S()},this.batch=function(e,t){var n=et(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(r){throw this._info("Exception during execution of batch",r),this.endBatch(),r}},this.addListener=function(e,t,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";return tt(e,t,r,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;s(e)},this.clearListeners=function(){pt={}},this.subscribe=function(e,t,o,i,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(l())throw"Illegal state: already disconnected";r(t)&&(s=i,i=o,o=t,t=void 0),r(i)&&(s=i,i=void 0);var a=!Y(e),c=tt(e,t,o,!1);if(a){var u={channel:"/meta/subscribe",subscription:e,_callback:s},g=this._mixin(!1,{},i,u);T(g)}return c},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(l())throw"Illegal state: already disconnected";r(t)&&(n=t,t=void 0),this.removeListener(e);var o=e.channel;if(!Y(o)){var i={channel:"/meta/unsubscribe",subscription:o,_callback:n},s=this._mixin(!1,{},t,i);T(s)}},this.resubscribe=function(e,t){return a(e),e?this.subscribe(e.channel,e.scope,e.callback,t):void 0},this.clearSubscriptions=function(){c()},this.publish=function(e,t,o,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(l())throw"Illegal state: already disconnected";r(t)?(i=t,t=o={}):r(o)&&(i=o,o={});var s={channel:e,data:t,_callback:i},a=this._mixin(!1,{},o,s);T(a)},this.getStatus=function(){return ut},this.isDisconnected=l,this.setBackoffIncrement=function(e){xt.backoffIncrement=e},this.getBackoffIncrement=function(){return xt.backoffIncrement},this.getBackoffPeriod=function(){return mt},this.setLogLevel=function(e){xt.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: extension name must be a string";for(var o=!1,i=0;i<bt.length;++i){var s=bt[i];if(s.name===e){o=!0;break}}return o?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(bt.push({name:e,extension:t}),this._debug("Registered extension",e),r(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!n(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,o=0;o<bt.length;++o){var i=bt[o];if(i.name===e){bt.splice(o,1),t=!0,this._debug("Unregistered extension",e);var s=i.extension;r(s.unregistered)&&s.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<bt.length;++t){var n=bt[t];if(n.name===e)return n.extension}return null},this.getName=function(){return st},this.getClientId=function(){return gt},this.getURL=function(){if(nt&&"object"==typeof xt.urls){var e=xt.urls[nt.getType()];if(e)return e}return xt.url},this.getTransport=function(){return nt},this.getConfiguration=function(){return this._mixin(!0,{},xt)},this.getAdvice=function(){return this._mixin(!0,{},yt)},org.cometd.WebSocket=window.WebSocket},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return void 0===e||null===e?!1:"string"==typeof e||e instanceof String},org.cometd.Utils.isArray=function(e){return void 0===e||null===e?!1:e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},org.cometd.Utils.setTimeout=function(e,t,n){return window.setTimeout(function(){try{e._debug("Invoking timed function",t),t()}catch(n){e._debug("Exception invoking timed function",t,n)}},n)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(){throw"Abstract"},org.cometd.Transport=function(){var e,t;this.registered=function(n,r){e=n,t=r},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return org.cometd.Utils.setTimeout(t,e,n)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(e){if(org.cometd.Utils.isString(e))try{return org.cometd.JSON.fromJSON(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(org.cometd.Utils.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(){throw"Abstract"},this.getType=function(){return e},this.send=function(){throw"Abstract"},this.reset=function(){this._debug("Transport",e,"reset")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){function e(e){for(;g.length>0;){var t=g[0],n=t[0],r=t[1];if(n.url!==e.url||n.sync!==e.sync)break;g.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;t.metaConnect===!0&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var o=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+o.getType()+" exceeded "+r+" ms max network delay",i={reason:n},s=t.xhr;i.httpCode=o.xhrStatus(s),o.abortXHR(s),o._debug(n),o.complete(t,!1,t.metaConnect),e.onFailure(s,e.messages,i)},r)}}function n(e){var n=++c,r={id:n,metaConnect:!1};l.length<this.getConfiguration().maxConnections-1?(l.push(r),t.call(this,e,r)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),g.push([e,r]))}function r(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==u&&u.id!==t)throw"Longpoll request mismatch, completing request "+t;u=null}function o(t,r){var o=org.cometd.Utils.inArray(t,l);if(o>=0&&l.splice(o,1),g.length>0){var i=g.shift(),s=i[0],a=i[1];if(this._debug("Transport dequeued request",a.id),r)this.getConfiguration().autoBatch&&e.call(this,s),n.call(this,s),this._debug("Transport completed request",t.id,s);else{var c=this;this.setTimeout(function(){c.complete(a,!1,a.metaConnect);var e={reason:"Previous request failed"},t=a.xhr;e.httpCode=c.xhrStatus(t),s.onFailure(t,s.messages,e)},0)}}}function i(e){if(null!==u)throw"Concurrent metaConnect requests not allowed, request id="+u.id+" not yet completed";var n=++c;this._debug("Transport",this.getType(),"metaConnect send, request",n,"envelope",e);var r={id:n,metaConnect:!0};t.call(this,e,r),u=r}var s=new org.cometd.Transport,a=org.cometd.Transport.derive(s),c=0,u=null,l=[],g=[];return a.complete=function(e,t,n){n?r.call(this,e):o.call(this,e,t)},a.transportSend=function(){throw"Abstract"},a.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},a.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},a.send=function(e,t){t?i.call(this,e):n.call(this,e)},a.abort=function(){s.abort();for(var e=0;e<l.length;++e){var t=l[e];this._debug("Aborting request",t),this.abortXHR(t.xhr)}u&&(this._debug("Aborting metaConnect request",u),this.abortXHR(u.xhr)),this.reset()},a.reset=function(){s.reset(),u=null,l=[],g=[]},a.abortXHR=function(e){if(e)try{e.abort()}catch(t){this._debug(t)}},a.xhrStatus=function(e){if(e)try{return e.status}catch(t){this._debug(t)}return-1},a},org.cometd.TransportRegistry=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,o){for(var i=[],s=0;s<e.length;++s){var a=e[s];t[a].accept(n,r,o)===!0&&i.push(a)}return i},this.negotiateTransport=function(n,r,o,i){for(var s=0;s<e.length;++s)for(var a=e[s],c=0;c<n.length;++c)if(a===n[c]){var u=t[a];if(u.accept(r,o,i)===!0)return u}return null},this.add=function(n,r,o){for(var i=!1,s=0;s<e.length;++s)if(e[s]===n){i=!0;break}return i||("number"!=typeof o?e.push(n):e.splice(o,0,n),t[n]=r),!i},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var o=t[n];return delete t[n],o}return null},this.clear=function(){e=[],t={}},this.reset=function(){for(var n=0;n<e.length;++n)t[e[n]].reset()}},org.cometd.WebSocketTransport=function(){function e(){if(!g){g=!0;var e=r.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);try{var t=r.getConfiguration().protocol,n=t?new org.cometd.WebSocket(e,t):new org.cometd.WebSocket(e)}catch(o){throw s=!1,this._debug("Exception while creating WebSocket object",o),o}c=r.getConfiguration().stickyReconnect!==!1;var i=this,a=null,u=r.getConfiguration().connectTimeout;u>0&&(a=this.setTimeout(function(){a=null,i._debug("Transport",i.getType(),"timed out while connecting to URL",e,":",u,"ms");var t={code:1e3,reason:"Connect Timeout"};i.webSocketClose(n,t.code,t.reason),i.onClose(n,t)},u));var l=function(){i._debug("WebSocket opened",n),g=!1,a&&(i.clearTimeout(a),a=null),f?(r._warn("Closing Extra WebSocket Connections",n,f),i.webSocketClose(n,1e3,"Extra Connection")):i.onOpen(n)},d=function(e){e=e||{code:1e3},i._debug("WebSocket closing",n,e),g=!1,a&&(i.clearTimeout(a),a=null),null!==f&&n!==f?i._debug("Closed Extra WebSocket Connection",n):i.onClose(n,e)},h=function(e){i._debug("WebSocket message",e,n),n!==f&&r._warn("Extra WebSocket Connections",n,f),i.onMessage(n,e)};n.onopen=l,n.onclose=d,n.onerror=function(){d({code:1002,reason:"Error"})},n.onmessage=h,this._debug("Transport",this.getType(),"configured callbacks on",n)}}function t(e,t,n){var r=org.cometd.JSON.toJSON(t.messages);e.send(r),this._debug("Transport",this.getType(),"sent",t,"metaConnect =",n);var o=this.getConfiguration().maxNetworkDelay,i=o;n&&(i+=this.getAdvice().timeout,d=!0);for(var s=this,a=[],c=0;c<t.messages.length;++c)!function(){var n=t.messages[c];n.id&&(a.push(n.id),l[n.id]=this.setTimeout(function(){s._debug("Transport",s.getType(),"timing out message",n.id,"after",i,"on",e);var t={code:1e3,reason:"Message Timeout"};s.webSocketClose(e,t.code,t.reason),s.onClose(e,t)},i))}();this._debug("Transport",this.getType(),"waiting at most",i,"ms for messages",a,"maxNetworkDelay",o,", timeouts:",l)}function n(n,r,o){try{null===n?e.call(this):t.call(this,n,r,o)}catch(i){this.setTimeout(function(){r.onFailure(n,r.messages,{exception:i})},0)}}var r,o=new org.cometd.Transport,i=org.cometd.Transport.derive(o),s=!0,a=!1,c=!0,u={},l={},g=!1,f=null,d=!1,h=null;return i.reset=function(){o.reset(),s=!0,a=!1,c=!0,u={},l={},g=!1,f=null,d=!1,h=null},i.onOpen=function(e){this._debug("Transport",this.getType(),"opened",e),f=e,a=!0,this._debug("Sending pending messages",u);for(var n in u){var r=u[n],o=r[0],i=r[1];h=o.onSuccess,t.call(this,e,o,i)}},i.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var n=!1,r=this.convertToMessages(t.data),o=[],i=0;i<r.length;++i){var s=r[i];if((/^\/meta\//.test(s.channel)||void 0!==s.successful)&&s.id){o.push(s.id);var a=l[s.id];a&&(this.clearTimeout(a),delete l[s.id],this._debug("Transport",this.getType(),"removed timeout for message",s.id,", timeouts",l))}"/meta/connect"===s.channel&&(d=!1),"/meta/disconnect"!==s.channel||d||(n=!0)}for(var c=!1,g=0;g<o.length;++g){var f=o[g];for(var p in u){var m=p.split(","),v=org.cometd.Utils.inArray(f,m);if(v>=0){c=!0,m.splice(v,1);var b=u[p][0],y=u[p][1];delete u[p],m.length>0&&(u[m.join(",")]=[b,y]);break}}}c&&this._debug("Transport",this.getType(),"removed envelope, envelopes",u),h.call(this,r),n&&this.webSocketClose(e,1e3,"Disconnect")},i.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),s=c&&a;var n=l;l={};for(var r in n)this.clearTimeout(n[r]);var o=u;u={};for(var i in o){var g=o[i][0],h=o[i][1];h&&(d=!1),g.onFailure(e,g.messages,{websocketCode:t.code,reason:t.reason})}f=null},i.registered=function(e,t){o.registered(e,t),r=t},i.accept=function(){return s&&!!org.cometd.WebSocket&&r.websocketEnabled!==!1},i.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);for(var r=[],o=0;o<e.messages.length;++o){var i=e.messages[o];i.id&&r.push(i.id)}u[r.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",u),n.call(this,f,e,t)},i.webSocketClose=function(e,t,n){try{e.close(t,n)}catch(r){this._debug(r)}},i.abort=function(){if(o.abort(),f){var e={code:1001,reason:"Abort"};this.webSocketClose(f,e.code,e.reason),this.onClose(f,e)}this.reset()},i},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),n=!0;return t.accept=function(e,t){return n||!t},t.xhrSend=function(){throw"Abstract"},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var r=this;try{var o=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(e.messages),onSuccess:function(o){r._debug("Transport",r.getType(),"received response",o);var i=!1;try{var s=r.convertToMessages(o);0===s.length?(n=!1,r.transportFailure(e,t,{httpCode:204})):(i=!0,r.transportSuccess(e,t,s))}catch(a){if(r._debug(a),!i){n=!1;var c={exception:a};c.httpCode=r.xhrStatus(t.xhr),r.transportFailure(e,t,c)}}},onError:function(i,s){n=!1;var a={reason:i,exception:s};a.httpCode=r.xhrStatus(t.xhr),o?r.setTimeout(function(){r.transportFailure(e,t,a)},0):r.transportFailure(e,t,a)}}),o=!1}catch(i){n=!1,this.setTimeout(function(){r.transportFailure(e,t,{exception:i})},0)}},t.reset=function(){e.reset(),n=!0},t},org.cometd.CallbackPollingTransport=function(){function e(e,t,n){var r=this;return function(){r.transportFailure(e,t,"error",n)}}var t=new org.cometd.RequestTransport,n=org.cometd.Transport.derive(t),r=2e3;return n.accept=function(){return!0},n.jsonpSend=function(){throw"Abstract"},n.transportSend=function(t,n){for(var o=this,i=0,s=t.messages.length,a=[];s>0;){var c=org.cometd.JSON.toJSON(t.messages.slice(i,i+s)),u=t.url.length+encodeURI(c).length;if(u>r){if(1===s){var l="Bayeux message too big ("+u+" bytes, max is "+r+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,l),0)}--s}else a.push(s),i+=s,s=t.messages.length-i}var g=t;if(a.length>1){var f=0,d=a[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",a.join(" + ")),g=this._mixin(!1,{},t),g.messages=t.messages.slice(f,d),g.onSuccess=t.onSuccess,g.onFailure=t.onFailure;for(var h=1;h<a.length;++h){var p=this._mixin(!1,{},t);f=d,d+=a[h],p.messages=t.messages.slice(f,d),p.onSuccess=t.onSuccess,p.onFailure=t.onFailure,this.send(p,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",g);try{var m=!0;this.jsonpSend({transport:this,url:g.url,sync:g.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(g.messages),onSuccess:function(e){var t=!1;try{var r=o.convertToMessages(e);0===r.length?o.transportFailure(g,n,{httpCode:204}):(t=!0,o.transportSuccess(g,n,r))}catch(i){o._debug(i),t||o.transportFailure(g,n,{exception:i})}},onError:function(e,t){var r={reason:e,exception:t};m?o.setTimeout(function(){o.transportFailure(g,n,r)},0):o.transportFailure(g,n,r)}}),m=!1}catch(v){this.setTimeout(function(){o.transportFailure(g,n,{exception:v})},0)}},n},function(){function e(e,t){function n(e,t){if(t)for(var n in t)"content-type"!==n.toLowerCase()&&e.setRequestHeader(n,t[n])}function r(){var r=new t.LongPollingTransport,o=t.Transport.derive(r);return o.xhrSend=function(t){return e.ajax({url:t.url,async:t.sync!==!0,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},o}function o(){var r=new t.CallbackPollingTransport,o=t.Transport.derive(r);return o.jsonpSend=function(t){e.ajax({url:t.url,async:t.sync!==!0,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},o}return t.JSON.toJSON=JSON.stringify,t.JSON.fromJSON=JSON.parse,e.CometD=function(e){var n=new t.CometD(e);return t.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new r),n.registerTransport("callback-polling",new o),n},e.cometd=new e.CometD,e.cometd}"function"==typeof define&&define.amd?define(["jquery","org/cometd"],e):e(jQuery,org.cometd)}(),function(){"use strict";function e(){}var t,n=new e,r=e.prototype,o=this,i=o.ZetaPush,s=$.cometd,a=null,c=!1,u=[];s.addListener("/meta/connect",function(e){if(s.isDisconnected())return c=!1,void log.info("connection closed");var t=c;c=e.successful,!t&&c?(log.info("connection established"),s.notifyListeners("/meta/connected",e),s.batch(function(){n.refresh()})):t&&!c&&log.warn("connection broken")}),s.addListener("/meta/handshake",function(e){e.successful?(log.debug("successful handshake",e),t=e.clientId):(log.warn("unsuccessful handshake"),t=null)}),r.isConnected=function(){return!s.isDisconnected()},r.generateChannel=function(e,t,n){return"/service/"+e+"/"+t+"/"+n},r.generateMetaChannel=function(e,t,n){return"/meta/"+e+"/"+t+"/"+n},r.on=function(e,t,n,o){if(1==arguments.length)var i=arguments[0];else if(2==arguments.length){var i={};i.channel=arguments[0],i.callback=arguments[1],u.push(i)}else{if(4!=arguments.length)throw"zetaPush.on - bad arguments";var i={};i.channel=r.generateChannel(e,t,n),i.callback=o,u.push(i)}var a=i.channel.split("/");if(a.length<=1)return s.notifyListeners("/meta/error","Syntax error in the channel name"),null;if("service"==a[1])i.isService=!0,c?(i.sub=s.subscribe(i.channel,i.callback),log.debug("subscribed",i)):log.debug("queuing subscription request",i);else{if("meta"!=a[1])return log.error("This event can t be managed by ZetaPush",evt),null;i.isService=!1,i.sub=s.addListener(i.channel,i.callback)}return null==i.renewOnReconnect&&(i.renewOnReconnect=!0),i
},r.off=function(e){e&&null!=e.sub&&(e.isService?(s.unsubscribe(e.sub),e.sub=null):(s.removeListener(e.sub),e.sub=null),log.debug("unsubscribed",e),e.renewOnReconnect=!1)},r.send=function(e,t,n,o){var i,a;2==arguments.length||1==arguments.length?(i=arguments[0],a=arguments[1]):(3==arguments.length||4==arguments.length)&&(i=r.generateChannel(e,t,n),a=o);var u=i.split("/");return u.length<=1?void s.notifyListeners("/meta/error","Syntax error in the channel name"):void("service"==u[1]?c&&s.publish(i,a):"meta"==u[1]&&s.notifyListeners(i,a))},r.init=function(e,t){log.setLevel(t),"debug"==t&&(s.websocketEnabled=!1),s.configure({url:e,logLevel:t,backoffIncrement:100,maxBackoff:500,appendMessageTypeToURL:!1})},r.disconnect=function(){s.disconnect(!0)},s.onListenerException=function(e,t,n,r){log.error("Uncaught exception for subscription",t,":",e,"message:",r),n?(s.removeListener(t),log.error("removed listener")):(s.unsubscribe(t),log.error("unsubscribed")),disconnect()},r.refresh=function(){log.debug("refreshing subscriptions");var e=[];u.forEach(function(t){t.sub&&(t.isService?s.unsubscribe(t.sub):s.removeListener(t.sub)),t.renewOnReconnect&&e.push(t)}),e.forEach(function(e){r.on(e)})},r.makeResourceId=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));localStorage.resource=e},r.connect=function(e){a=e,s.handshake(e)},r.reconnect=function(){connect(a)},e.noConflict=function(){return o.ZetaPush=i,n},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:o.zetaPush=n}.call(this);